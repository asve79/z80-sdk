# Процесс

## Тестирование и отладка
- [ ] Проверить что контрольные значения в реестре устанавливаются верно (дескритор и границы буфера)
- [x] Прием данных одного соединения в один буфер. Данные короткие (меньше буфера)
- [x] Прием данных нескольких соединения в один буфер. Данные короткие (меньше буфера)
- [x] Проверить что будет, если придут данные из незарегистрированного соединения
- [x] Проверка как дописываются данные в один буфер если пришло несколько кусков (несколько команд +ipd)
- [x] Проверить что будет если пршли данные > 2k в одном соединение. Что выдаст ESP модуль, разобьет ли на блоки
- [ ] Проверить реакцию на переполнение буфера, когда идут данные большими кусками. Должен класть в бучер ровно столько сколько в него поместится.
- [ ] Оттестировать что когда идут большие блоки в IPD, они корректно принемаются т к в этому случае обработка идет порционно
- [ ] Оттестировать ситуацию когда за блоком данных идет команда IPD которая попала на границу UART буфера

## Сопутствующие ф-ции и TODO
- [x] Обработка ситуации с таймаутом
- [x] Работа с реестром подключений (выделение номера, удаление номера)
- [x] Работа с реестром подключений (загрузка данных по ID в указанный буфер)
- [x] Тестирование мультисоединений (открыть 2 или 3 одновременно, отправить запрос)
- [x] Решить что делать с реестром если после приема данных соединение отключилось. Решение: вызвать call-back ф-цию, удалить соединение из реестра.
- [ ] Передать в ф-цию перекладки данных в целефой буфер размер блока исходя из текущего указателя на буфере UART-а. Т е если в UART-е 100 байт осталось а в IPD значится 1000 байт на передачу.
- [ ] Внедрить регистрацию процедур реагирующих на прием/переполнение буфера и обрыв соединения
- [ ] Добавить определение ситуации когда целеыой буфер переполнен и вызывать соотв ф-цию
- [ ] Также прверять что буфер резко не кончится. По-хорошему надо понимать что если встретили IPD, и символов 10, то лучше уж подождать прихода новых данных
- [ ] Реализовать корректную обработку ситуации, когда размер текущего блока данных закончила, а граница попала на часть блока данных команды IPD. Т.е следующий вызов должен "дочитывать" кусок данных.
- [ ] Надо проверять на строку 'N,DISCONNECT' на предмет потери соединения
- [ ] При инициализации проверять и сбрасывать активные соединения, если таковые имеются
- [ ] При инициализации отключаться от wifi (?) Спорная ф-ция, подумать.

- [ ] Рефактор таймаута. Текущее определение времени "плавает"

## Мысли на долгосрок
- [ ] После введения менеджера памяти, для буфера указывать номер страницы и банки, где будут лежать данные. 
- [ ] При записи перекладывать данные через DMA