001   0000             ;”г­ЄжЁЁ а Ў®вл б ®Є®­­®© бЁбвҐ¬®© ¤«п бв ­¤ авЁ§ жЁЁ
002   0000             		MODULE	wind
003   0000             
004   0000 DD 22 0A 01 printw		LD	(wind.current_sow),IX
005   0004 F5          		PUSH	AF
006   0005 3E 01       		LD	A,1
007   0007 CD 06 60    		CALL	#6006
008   000A F1          		POP	AF
009   000B C9          		RET
010   000C             
011   000C F5          closew		PUSH	AF
012   000D DD 2A 0A 01 		LD	IX,(wind.current_sow)
013   0011 3E 02       		LD	A,2
014   0013 CD 06 60    		CALL	#6006		
015   0016 AF          		XOR	A
016   0017 32 0A 01    		LD	(wind.current_sow),A
017   001A 32 0B 01    		LD	(wind.current_sow+1),A
018   001D F1          		POP	AF
019   001E C9          		RET
020   001F             
021   001F F5          cur_on		PUSH	AF
022   0020 DD 2A 0A 01 		LD	IX,(wind.current_sow)
023   0024 3E 06       		LD	A,6
024   0026 CD 06 60    		CALL	#6006
025   0029 F1          		POP	AF
026   002A C9          		RET
027   002B             
028   002B F5          cur_off		PUSH	AF
029   002C DD 2A 0A 01 		LD	IX,(wind.current_sow)
030   0030 3E 07       		LD	A,7
031   0032 CD 06 60    		CALL	#6006
032   0035 F1          		POP	AF
033   0036 C9          		RET
034   0037             
035   0037             ;IN:
036   0037             ; B=H
037   0037             ; C=W
038   0037             ; D=Y
039   0037             ; E=X
040   0037 F5          scroll_area_up	PUSH	AF
041   0038 DD 2A 0A 01 		LD	IX,(wind.current_sow)
042   003C C5          l1		PUSH	BC
043   003D D5          		PUSH	DE
044   003E 41          		LD	B,C
045   003F C5          l2		PUSH	BC
046   0040 D5          		PUSH	DE
047   0041 3E 05       		LD	A,5		;5¦GADRW - получение адреса в окне
048   0043 CD 06 60    		CALL	#6006
049   0046 7E          		LD	A,(HL)
050   0047 F5          		PUSH	AF
051   0048 3E 05       		LD	A,5		;5¦GADRW - получение адреса в окне
052   004A CD 06 60    		CALL	#6006
053   004D F1          		POP	AF
054   004E 77          		LD	(HL),A		
055   004F D1          		POP	DE
056   0050 1C          		INC	E		;increment X
057   0051 C1          		POP	BC
058   0052 10 EB       		DJNZ	l2
059   0054 D1          		POP	DE		;restore X
060   0055 14          		INC	D		;increment Y
061   0056 C1          		POP	BC
062   0057 10 E3       		DJNZ	l1
063   0059             
064   0059             
065   0059 F1          		POP	AF
066   005A C9          		RET
067   005B             
068   005B             ;- print one symbol
069   005B             ; IN: A - char
070   005B DD E5       printc		PUSH	IX
071   005D C5          		PUSH	BC
072   005E D5          		PUSH	DE
073   005F E5          		PUSH	HL
074   0060 DD 2A 0A 01 		LD	IX,(wind.current_sow)
075   0064 DD 5E 0C    		LD	E,(IX+12)	;X позиция курсора в окне (от 1)
076   0067 DD 56 0D    		LD	D,(IX+13)	;Y нижний ограничитель
077   006A FE 0D       		CP	13		;CR + LF
078   006C 28 1A       		JR	Z,1f
079   006E FE 0A       		CP	10		;LF
080   0070 28 1B       		JR	Z,4f
081   0072 F5          		PUSH	AF
082   0073 3E 05       		LD	A,5		;5¦GADRW - получение адреса в окне
083   0075 CD 06 60    		CALL	#6006
084   0078 F1          		POP	AF
085   0079 77          		LD	(HL),A
086   007A DD 7E 04    		LD	A,(IX+4)	;ширина окна (Width)
087   007D D6 02       		SUB	2
088   007F BB          		CP	E
089   0080 28 06       		JR	Z,1f
090   0082 1C          		INC	E
091   0083 DD 73 0C    		LD	(IX+12),E	;X позиция курсора в окне (от 1)
092   0086 18 29       		JR	3f
093   0088 3E 01       1		LD	A,1
094   008A DD 77 0C    		LD	(IX+12),A	;X позиция курсора в окне (от 1)
095   008D DD 7E 05    4		LD	A,(IX+5)	;высота окна (Height)
096   0090 D6 02       		SUB	2
097   0092 BA          		CP	D
098   0093 28 06       		JR	Z,2f
099   0095 14          		INC	D
100   0096 DD 72 0D    		LD	(IX+13),D	;Y position
101   0099 18 16       		JR	3f
102   009B 3E 54       2		LD	A,84		;¦SCRLWOW
103   009D 11 01 01    		LD	DE,#0101	;X,Y = 1. Не трогаем рамку
104   00A0 DD 4E 04    		LD	C,(IX+4)	;ширина окна (Width)
105   00A3 DD 46 05    		LD	B,(IX+5)	;высота окна (Height)
106   00A6 0D          		DEC	C
107   00A7 0D          		DEC	C
108   00A8 05          		DEC	B
109   00A9 05          		DEC	B						
110   00AA 08          		EXA
111   00AB             ;;		LD	A,#C1
112   00AB 3E 01       		LD	A,#01
113   00AD 08          		EXA
114   00AE CD 06 60    		CALL	#6006
115   00B1             ;		CALL	wind.scroll_area_up
116   00B1 E1          3		POP	HL
117   00B2 D1          		POP	DE
118   00B3 C1          		POP	BC
119   00B4 DD E1       		POP	IX
120   00B6 C9          		RET
121   00B7             
122   00B7             ;IN: HL - string
123   00B7             ;OUT: HL - EOF
124   00B7 F5          prints		PUSH	AF
125   00B8 7E          1		LD	A,(HL)
126   00B9 B7          		OR	A
127   00BA 28 06       		JR	Z,2f
128   00BC CD 5B 00    		CALL	wind.printc
129   00BF 23          		INC	HL
130   00C0 18 F6       		JR	1b
131   00C2 F1          2		POP	AF
132   00C3 C9          		RET
133   00C4             
134   00C4 E5          a_hex		PUSH	HL
135   00C5 F5          		PUSH	AF
136   00C6 08          		EX	AF,AF'
137   00C7 21 05 01    		LD	HL,wind.bufer
138   00CA 3E 0A       		LD	A,10		;NORK A - to hex. перевод байта в HEX (текстовый формат)
139   00CC CD 06 60    		CALL	#6006		
140   00CF AF          		XOR	A
141   00D0 32 07 01    		LD	(wind.bufer+2),A
142   00D3 21 05 01    		LD	HL,wind.bufer
143   00D6 CD B7 00    		CALL	wind.prints
144   00D9 F1          		POP	AF
145   00DA E1          		POP	HL
146   00DB C9          		RET
147   00DC             
148   00DC C5          hl_hex		PUSH	BC
149   00DD E5          		PUSH	HL
150   00DE C1          		POP	BC
151   00DF 78          		LD	A,B
152   00E0 F5          		PUSH	AF
153   00E1 D9          		EXX
154   00E2 F1          		POP	AF
155   00E3 D9          		EXX
156   00E4 21 05 01    		LD	HL,bufer
157   00E7 3E 0A       		LD	A,10		;NORK A - to hex
158   00E9 CD 06 60    		CALL	#6006		
159   00EC 79          		LD	A,C
160   00ED F5          		PUSH	AF
161   00EE D9          		EXX
162   00EF F1          		POP	AF
163   00F0 D9          		EXX
164   00F1 21 07 01    		LD	HL,bufer+2
165   00F4 3E 0A       		LD	A,10		;NORK A - to hex
166   00F6 CD 06 60    		CALL	#6006		
167   00F9 AF          		XOR	A
168   00FA 32 09 01    		LD	(bufer+4),A
169   00FD 21 05 01    		LD	HL,bufer
170   0100 CD B7 00    		CALL	prints
171   0103 C1          		POP	BC
172   0104 C9          		RET
173   0105             
174   0105 00          bufer		DS	5
175   010A 00 00       current_sow	DW	0	;current window
176   010C             		ENDMODULE
